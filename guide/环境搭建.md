---
description: braid 的使用需要安装一些依赖项才能正确启动，这一页用于指引用户安装所需的依赖项
---

# 1. 环境搭建

> braid 推荐在docker环境下执行，因此后面的指引都将依赖 docker环境进行。
>
> docker 版本需求 `v1.13.1 +`



#### 依赖项

> **加粗项**是braid**必须**安装的基础依赖服务

* **Consul**         (注册中心
* **Registerator**   (容器注册
* **NSQ**            (消息队列
* Jaeger             (分布式追踪
* Redis              (内存型缓存
* Braid-web          (可视化



##### Consul

> 必选，注册中心服务。

```shell
$ docker pull consul:1.6.2

# 这里为了方便测试所以只启动单个server，正式环境请按需求正确部署。
$ docker run \
   -d \
   -p 8500:8500 \
   --name=consul_s_1 \
   consul:1.6.2 agent -server -ui -node=s_1 -bootstrap-expect=1 -client=0.0.0.0
   
# 参数简单介绍
# -p 8500:8500          对外的端口
# --name=consul_s_1     集群内的唯一命名
# consul:1.6.2          使用的docker镜像版本
# agent                 Agent是运行在consul成员上的守护进程
# -server               以server模式运行
# -ui                   开启web控制台
# -node=s_1             当前node的名称
# -bootstrap-expect=1   表示节点是master节点，且期望有1个子节点（联结到期望的节点才会开启服务
# -client=0.0.0.0       客户端服务注册的地址
```



##### Registerator

> 必选，用于将docker注册到consul。
>
> 注: braid推荐用户在docker环境下运行，所以并没有提供服务注册类接口。但是如果用户必须要在本地运行，也可以参照sample里面代码`common.Regist` 示例了通过consul的http api来注册本地服务。

```shell
$ docker pull gliderlabs/registrator:latest

$ docker run -d \
   --name=registrator \
   --volume=/var/run/docker.sock:/tmp/docker.sock \
   gliderlabs/registrator:latest \
       --internal=false \
       --ip=172.17.0.1 \
     consul://172.17.0.1:8500
     
# 参数简单介绍
# --volume=/var/run/docker.sock:/tmp/docker.sock   数据卷，允许Registrator访问Docker API
# gliderlabs/registrator:latest  使用镜像版本
# --internal=false               不使用暴露端口代替发布端口
# --ip=172.17.0.1                指定注册服务的ip地址（这里使用的是docker0 网桥地址
# consul://172.17.0.1:8500       注册中心地址
```



##### NSQ

> 必选，用于modules/mailboxnsq ，主要提供 `集群内 | 进程内` 的消息发布订阅。

```shell
$ docker pull nsqio/nsq:v1.2.0

# nsq需要启动3个服务 lookupd & nsqd & admin

# nsqlookup
$ docker run --name lookupd -p 4160:4160 -p 4161:4161 -d nsqio/nsq /nsqlookupd

# nsqd
$ docker run --name nsqd -p 4150:4150 -p 4151:4151 -d nsqio/nsq /nsqd --broadcast-address=172.17.0.1 --lookupd-tcp-address=172.17.0.1:4160

# admin
$ docker run -d --name nsqadmin -p 4171:4171 nsqio/nsq /nsqadmin --lookupd-http-address=172.17.0.1:4161

# 参数简单介绍
# --broadcast-address      广播自身的地址（需要lookupd能够访问到
# --lookupd-tcp-address    lookupd地址
# --lookupd-http-address   ...
```



##### Jaeger

> 可选服务，jaegertracing 服务于 modules/jaegertracing 当注册这个module时，需要安装此服务。

```shell
$ docker pull jaegertracing/all-in-one:1.17.1

$ docker run --rm -d \
   -p 14250:14250/tcp \
   -p 14268:14268/tcp \
   -p 16686:16686/tcp \
   -p 5775:5775/udp \
   -p 5778:5778/tcp \
   -p 6831:6831/udp \
   -p 6832:6832/udp \
   jaegertracing/all-in-one:1.17.1
```



##### Redis

> 可选服务，redis 服务于 modules/linkerredis 当注册这个module时，需要安装此服务。

```shell
$ docker pull redis:5.0.4

$ docker run -p 6379:6379 -v $PWD/data:/data -d redis:5.0.4 redis-server --appendonly yes
```



##### Braid-web

> 可选服务，web目前主要提供braid查看服务的连接情况，将来会持续扩充可视化的功能。
>
> 注: web 依赖`link-cache`模块，只有当link-cache被注册到`braid`中，才能够正常提供服务。

```shell
$ docker pull braidgo/sankey:latest

$ docker run -d -p 8888:8888/tcp braidgo/sankey:latest \
    -consul http://172.17.0.1:8900 \
    -redis redis://172.17.0.1:6379/0
```